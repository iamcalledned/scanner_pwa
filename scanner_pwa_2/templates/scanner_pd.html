<!-- Updated scanner_pd.html with persistent login button -->
<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FRCK642NXJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-FRCK642NXJ');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scanner Archive</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <!-- Body background with gradient -->
  <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-gray-900 via-blue-900/50 to-gray-900 -z-10"></div>

<div class="max-w-4xl mx-auto px-4 py-8">
  <div class="text-center mb-12">
      <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 animate-pulse">
        ğŸš“ Today's Police Calls
      </h1>
      <p class="text-gray-400 mt-2">Hopedale Office for Pretend Emergencies</p>
    </div>

  <div class="flex justify-between items-center mb-4">
    <p class="text-sm text-gray-400">Total calls: {{ calls|length }}</p>
    <div class="flex gap-4">
      <a href="/scanner/archive" class="text-blue-400 hover:underline">View Archive &rarr;</a>
      <a href="/scanner/segments" class="text-green-400 hover:underline">ğŸŒ± Make Us Better</a>
    </div>
  </div>

<div id="calls-container" class="space-y-8">
  {% for call in calls %}
  <div class="bg-gray-800/50 backdrop-blur-sm p-6 rounded-2xl shadow-lg ring-1 ring-white/10">
    <div class="text-sm text-gray-400 mb-2">{{ call.timestamp_human }} | {{ call.feed }}</div>
    <audio class="w-full mb-4" controls src="{{ call.path }}"></audio>

    <div class="space-y-4">
      {% if call.metadata and call.metadata.enhanced_transcript %}
        <div>
          <div class="text-purple-400 font-semibold text-sm mb-2">âœ¨ Enhanced Transcript</div>
          <pre class="whitespace-pre-wrap bg-purple-900/50 p-3 rounded-md text-sm text-purple-100 overflow-auto">{{ call.metadata.enhanced_transcript }}</pre>
        </div>
      {% endif %}

      {% if call.metadata and call.metadata.edited_transcript %}
        <div>
          <div class="text-green-400 font-semibold text-sm mb-2">âœ… Edited Transcript</div>
          <pre class="whitespace-pre-wrap bg-green-800/50 p-3 rounded-md text-sm text-green-100 overflow-auto">{{ call.metadata.edited_transcript }}</pre>
        </div>
      {% elif call.edit_pending %}
        <div>
          <div class="text-yellow-400 font-semibold text-sm mb-2">âœï¸ Edit Pending</div>
          <pre class="whitespace-pre-wrap bg-yellow-800/50 p-3 rounded-md text-sm text-yellow-100 overflow-auto">{{ call.edited_transcript }}</pre>
        </div>
      {% endif %}

      <div>
        <div class="text-gray-400 font-semibold text-sm mb-2">ğŸ§ Original Transcript</div>
        <pre id="pre-{{ loop.index }}" class="whitespace-pre-wrap bg-gray-700/50 p-3 rounded-md text-sm text-gray-200 overflow-auto">{{ call.transcript }}</pre>
        <textarea id="edit-{{ loop.index }}" class="w-full bg-gray-800 text-sm p-3 rounded-md text-white border border-gray-600 hidden">{{ call.transcript }}</textarea>

        <div class="flex gap-2 mt-2">
          <button onclick="enableEdit({{ loop.index }})" class="text-yellow-400 hover:underline text-sm">Edit</button>
          <button onclick="submitEdit('{{ call.file }}', '{{ call.feed }}', {{ loop.index }})" id="save-{{ loop.index }}" class="hidden text-green-400 hover:underline text-sm">Submit</button>
          <button onclick="cancelEdit({{ loop.index }})" id="cancel-{{ loop.index }}" class="hidden text-red-400 hover:underline text-sm">Cancel</button>
        </div>
        <div id="msg-{{ loop.index }}" class="text-green-400 text-sm hidden">âœ”ï¸ Thank you for your submission!</div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>


  <div id="loading-indicator" class="text-center text-gray-400 py-4 hidden">Loading more calls...</div>
  {% if not calls %}
  <p class="text-gray-400">No calls available yet. Check back soon.</p>
  {% endif %}
</div>

<script src="/static/js/app.js"></script>
<script>
  window.addEventListener('scroll', () => loadMoreCalls('/scanner_pd'));
  window.addEventListener('touchmove', () => loadMoreCalls('/scanner_pd'));
</script>
<div id="auth-fixed" class="fixed top-4 right-4 z-50">
  <a id="auth-btn" href="/scanner/login"
     class="px-3 py-2 rounded-lg bg-blue-700/80 hover:bg-blue-600 backdrop-blur text-white text-sm shadow">
    ğŸ”’ Login
  </a>
  <div id="auth-menu" class="hidden bg-gray-800 text-sm text-white rounded-lg shadow p-3 mt-2">
    <div id="auth-user" class="text-xs text-gray-300 mb-2"></div>
    <a href="/scanner/logout" class="underline">Logout</a>
  </div>
</div>


</body>
</html>