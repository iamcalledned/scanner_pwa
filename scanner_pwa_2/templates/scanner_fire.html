<!-- Updated scanner_fire.html with persistent login button -->
<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FRCK642NXJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-FRCK642NXJ');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fire Scanner Archive</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">

  
<div class="max-w-4xl mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-6 text-center">üî• Fire Scanner Call Archive</h1>
  <div class="flex justify-between items-center mb-4">
    <p class="text-sm text-gray-400">Total calls: {{ calls|length }}</p>
    <div class="flex gap-4 items-center">
      <a href="/scanner_fire/archive" class="text-blue-400 hover:underline">View Archive &rarr;</a>
    </div>
  </div>

  <div id="calls-container">
    {% for call in calls %}
    <div class="mb-6 p-4 rounded-xl bg-gray-800 shadow-md call-entry">
      <div class="text-sm text-gray-400 mb-1">{{ call.timestamp_human }} {{ call.feed }}</div>
      <audio class="w-full mb-2" controls src="{{ call.path }}"></audio>

      <div class="space-y-2">
        {% if call.edit_pending %}
          <div class="text-yellow-400 text-sm">‚úèÔ∏è Edit Pending</div>
          <pre class="whitespace-pre-wrap bg-yellow-800 p-3 rounded-md text-sm text-yellow-100 overflow-auto">{{ call.edited_transcript }}</pre>
          <div class="text-sm text-gray-400">Original Transcript:</div>
          <pre class="whitespace-pre-wrap bg-gray-700 p-3 rounded-md text-sm text-gray-300 overflow-auto">{{ call.transcript }}</pre>
        {% else %}
          <pre id="pre-{{ loop.index }}" class="whitespace-pre-wrap bg-gray-700 p-3 rounded-md text-sm text-gray-200 overflow-auto">{{ call.transcript }}</pre>
          <textarea id="edit-{{ loop.index }}" class="w-full bg-gray-800 text-sm p-3 rounded-md text-white border border-gray-600 hidden">{{ call.transcript }}</textarea>

          <div class="flex gap-2">
            <button onclick="enableEdit({{ loop.index }})" class="text-yellow-400 hover:underline text-sm">Edit</button>
            <button onclick="submitEdit('{{ call.file }}', '{{ call.feed }}', {{ loop.index }})" id="save-{{ loop.index }}" class="hidden text-green-400 hover:underline text-sm">Submit</button>
            <button onclick="cancelEdit({{ loop.index }})" id="cancel-{{ loop.index }}" class="hidden text-red-400 hover:underline text-sm">Cancel</button>
          </div>
          <div id="msg-{{ loop.index }}" class="text-green-400 text-sm hidden">‚úîÔ∏è Thank you for your submission!</div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>

  <div id="loading-indicator" class="text-center text-gray-400 py-4 hidden">Loading more calls...</div>
  {% if not calls %}
  <p class="text-gray-400">No calls available yet. Check back soon.</p>
  {% endif %}
</div>

<script src="/static/js/app.js"></script>
<script>
  window.addEventListener('scroll', () => loadMoreCalls('/scanner_fire'));
  window.addEventListener('touchmove', () => loadMoreCalls('/scanner_fire'));
</script>
<div id="auth-fixed" class="fixed top-4 right-4 z-50">
  <a id="auth-btn" href="/scanner/login"
     class="px-3 py-2 rounded-lg bg-blue-700/80 hover:bg-blue-600 backdrop-blur text-white text-sm shadow">
    üîí Login
  </a>
  <div id="auth-menu" class="hidden bg-gray-800 text-sm text-white rounded-lg shadow p-3 mt-2">
    <div id="auth-user" class="text-xs text-gray-300 mb-2"></div>
    <a href="/scanner/logout" class="underline">Logout</a>
  </div>
</div>


</body>
</html>