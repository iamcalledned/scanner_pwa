<!-- Updated scanner_fire.html with persistent login button -->
<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FRCK642NXJ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);} 
    gtag('js', new Date());
    gtag('config', 'G-FRCK642NXJ');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fire Scanner Archive</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <!-- Body background with gradient -->
  <div class="fixed top-0 left-0 w-full h-full bg-gradient-to-br from-gray-900 via-red-900/50 to-gray-900 -z-10"></div>

<div class="max-w-4xl mx-auto px-4 py-8">
  <div class="text-center mb-12">
      <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 to-orange-500 animate-pulse">
        üî• Fire & EMS Calls
      </h1>
      <p class="text-gray-400 mt-2">Hopedale Fire Department</p>
    </div>

  <div class="flex justify-between items-center mb-4">
    <p id="total-calls" class="text-sm text-gray-400">Total calls: {{ calls|length }}</p>
    <div class="flex gap-4">
      <a href="/scanner_fire/archive" class="text-blue-400 hover:underline">View Archive &rarr;</a>
    </div>
  </div>

<div id="calls-container" class="space-y-8">
  {% for call in calls %}
  <div class="bg-gray-800/50 backdrop-blur-sm p-6 rounded-2xl shadow-lg ring-1 ring-white/10">
    <div class="text-sm text-gray-400 mb-2">{{ call.timestamp_human }} | {{ call.feed }}</div>
    <audio class="w-full mb-4" controls src="{{ call.path }}"></audio>

    <div class="space-y-4">
      {% if call.edit_pending %}
        <div>
          <div class="text-yellow-400 font-semibold text-sm mb-2">‚úèÔ∏è Edit Pending</div>
          <pre class="whitespace-pre-wrap bg-yellow-800/50 p-3 rounded-md text-sm text-yellow-100 overflow-auto">{{ call.edited_transcript }}</pre>
          <div class="text-sm text-gray-400">Original Transcript:</div>
          <pre class="whitespace-pre-wrap bg-gray-700/50 p-3 rounded-md text-sm text-gray-300 overflow-auto">{{ call.transcript }}</pre>
        </div>
      {% else %}
        <div>
          <div class="text-gray-400 font-semibold text-sm mb-2">üéß Original Transcript</div>
          <pre id="pre-{{ loop.index }}" class="whitespace-pre-wrap bg-gray-700/50 p-3 rounded-md text-sm text-gray-200 overflow-auto">{{ call.transcript }}</pre>
          <textarea id="edit-{{ loop.index }}" class="w-full bg-gray-800 text-sm p-3 rounded-md text-white border border-gray-600 hidden">{{ call.transcript }}</textarea>

          <div class="flex gap-2 mt-2">
            <button onclick="enableEdit({{ loop.index }})" class="text-yellow-400 hover:underline text-sm">Edit</button>
            <button onclick="submitEdit('{{ call.file }}', '{{ call.feed }}', {{ loop.index }})" id="save-{{ loop.index }}" class="hidden text-green-400 hover:underline text-sm">Submit</button>
            <button onclick="cancelEdit({{ loop.index }})" id="cancel-{{ loop.index }}" class="hidden text-red-400 hover:underline text-sm">Cancel</button>
          </div>
          <div id="msg-{{ loop.index }}" class="text-green-400 text-sm hidden">‚úîÔ∏è Thank you for your submission!</div>
        </div>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>


  <div id="loading-indicator" class="text-center text-gray-400 py-4 hidden">Loading more calls...</div>
  {% if not calls %}
  <p class="text-gray-400">No calls available yet. Check back soon.</p>
  {% endif %}
</div>

<script src="/static/js/app.js"></script>
<script src="/static/js/pwa.js"></script>
<script>
  window.addEventListener('scroll', () => loadMoreCalls('/scanner_fire'), { passive: true });
  window.addEventListener('touchmove', () => loadMoreCalls('/scanner_fire'), { passive: true });
</script>
<div class="fixed top-4 left-4 z-50">
  <button id="hamburger-btn" class="p-2 rounded-md bg-gray-800/50 text-white hover:bg-gray-700/50 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white">
    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>
  <div id="mobile-menu" class="hidden absolute top-12 left-0 bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg p-4 space-y-2">
    <div id="auth-user" class="text-xs text-gray-300"></div>
    <a id="auth-btn" href="/scanner/login" class="block w-full text-left px-3 py-2 rounded-md text-base font-medium text-white hover:bg-gray-700">
      üîí Login
    </a>
    <a href="/scanner/logout" id="logout-btn" class="hidden block w-full text-left px-3 py-2 rounded-md text-base font-medium text-white hover:bg-gray-700">
      Logout
    </a>
  </div>
</div>


</body>
</html>